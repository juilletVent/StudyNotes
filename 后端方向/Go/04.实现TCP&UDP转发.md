## TCP 数据转发

```go
package main

import (
	"fmt"
	"io"
	"net"
)

func handleClient(clientConn net.Conn) {
	// 连接到目标服务器
	serverConn, err := net.Dial("tcp", "1.1.1.1:5000")
	if err != nil {
		fmt.Println("Failed to connect to server:", err)
		return
	}
	defer serverConn.Close()

	// 在本地连接关闭时关闭服务器连接
	defer clientConn.Close()

	// 数据转发
	go func() {
		_, err := io.Copy(serverConn, clientConn)
		if err != nil {
			fmt.Println("Failed to copy from client to server:", err)
		}
	}()

	_, err = io.Copy(clientConn, serverConn)
	if err != nil {
		fmt.Println("Failed to copy from server to client:", err)
	}
}

func ForwardTCP() {
	// 监听本地端口80
	listener, err := net.Listen("tcp", "127.0.0.1:80")
	if err != nil {
		fmt.Println("Failed to start server:", err)
		return
	}
	defer listener.Close()

	fmt.Println("Server started. Listening on port 80...")

	for {
		// 等待客户端连接
		clientConn, err := listener.Accept()
		if err != nil {
			fmt.Println("Failed to accept connection:", err)
			continue
		}
		fmt.Println("Client connected:", clientConn.RemoteAddr())

		// 处理客户端连接
		go handleClient(clientConn)
	}
}

```

## UDP 数据转发

```go
package main

import (
	"fmt"
	"net"
)

var mtu = 65535

func ForwardUDP() {
	localServerAddr, _ := net.ResolveUDPAddr("udp", ":26126")
	localSenderAddr, _ := net.ResolveUDPAddr("udp", ":12321")
	wsServerAddr, _ := net.ResolveUDPAddr("udp", "1.1.1.1:16666")

	connLocalServerAddr, _ := net.ListenUDP("udp", localServerAddr)
	connLocalSenderAddr, _ := net.ListenUDP("udp", localSenderAddr)
	defer connLocalServerAddr.Close()
	defer connLocalSenderAddr.Close()

	var clientAddress *net.UDPAddr

	go func() {
		for {
			buf := make([]byte, mtu)

			n, src, _ := connLocalServerAddr.ReadFromUDP(buf)
			clientAddress = src
			// fmt.Printf("client -> server: %x from %s\n", buf[:n], src.String())

			_, err := connLocalSenderAddr.WriteToUDP(buf[:n], wsServerAddr)

			if err != nil {
				fmt.Printf("client -> server forward failed: %s\n", err.Error())
			}
		}
	}()

	go func() {
		for {
			buf := make([]byte, mtu)

			n, _, _ := connLocalSenderAddr.ReadFromUDP(buf)

			// fmt.Printf("client <- server: %x from %s\n", buf[:n], src.String())

			_, err := connLocalServerAddr.WriteToUDP(buf[:n], clientAddress)

			if err != nil {
				fmt.Printf("client <- server forward failed: %s\n", err.Error())
			}
		}
	}()

	select {}
}

```

## 指定本地 Socket 使用的 IP 地址与端口

```go
// 创建一个Dialer
dialer := &net.Dialer{
		LocalAddr: &net.TCPAddr{
				IP:   net.IPv4(127, 0, 0, 1), // 本地IP地址
				Port: 12345,                  // 本地源端口
		},
}

// 使用Dialer连接远程地址
conn, err := dialer.Dial("tcp", "remote_host:remote_port")
if err != nil {
		panic(err)
}
```
