## 问题描述

在 zerotier 组网中，内网网关建立 zerotier 连接后需要代理内网访问需要做如下配置：

```shell
#!/bin/bash

# FORWARD 按网卡放行
iptables -A FORWARD -i ztfmvusnhh -o ens18 -j ACCEPT
iptables -A FORWARD -i ens18 -o ztfmvusnhh -m state --state ESTABLISHED,RELATED -j ACCEPT

# 只对“从 ZeroTier → 内网”的流量做 SNAT
iptables -t nat -A POSTROUTING -s 10.0.100.177/24 -o ens18 -j MASQUERADE

# 处理 MTU 问题
# 设置虚拟网卡 MTU 为 1500
ip link set dev ztfmvusnhh mtu 1500
# 匹配 ZeroTier → 内网的 TCP 流量，关心 SYN + RST 标志位，匹配具备SYN，不具备RST位的TCP包，动作：调整MSS为PMTU
iptables -t mangle -A FORWARD -i ztfmvusnhh -o ens18 -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu
```

核心关注点为：Zerotier 虚拟网卡默认 MTU（2800） 超过物理链路的 MTU（1500），并且默认情况下很多 TCP 包设置了 DF 位，导致 IP 分片失败，数据包无法通过物理链路传输，需要在连接建立伊始就调整 MSS 为 PMTU。
