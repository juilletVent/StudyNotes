## Docker 日志清理

长时间运行 Docker 容器会产生大量日志文件，占满磁盘空间，通过下面的方法可以清理 Docker 日志文件以及限制日志文件大小。

### 清理

```shell
# 立刻清理日志
find /var/lib/docker/containers/ -name "*-json.log" -size +10M -exec truncate -s 0 {} \;
# 定期清理 crontab
0 4 * * * find /var/lib/docker/containers/ -name "*-json.log" -size +500M -exec truncate -s 0 {} \;
```

### 封印(限制日志大小)

```json
// vim /etc/docker/daemon.json
// 如果已有内容，合并 JSON

{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "20m",
    "max-file": "5"
  }
}

// systemctl restart docker
```

## Docker 镜像清理

```shell
# 查看Docker存储情况
docker system df

# 删除未使用镜像
docker image prune -a
# 删除未使用存储块儿
docker system prune
```
